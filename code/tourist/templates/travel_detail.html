{% extends 'base.html' %}

{% block title %}行程詳細頁面{% endblock %}
{% block content %}
<link rel="stylesheet" href="../static/css/travel_detail.css">
{% comment %} CSS放這~~ {% endcomment %}
<style>
<style>
body {
  margin: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.container {
    width: 100%;
    margin: 80px auto 0;
    display:flex;
    flex-direction: column;
    max-width: 1200px;
}

header {
    display: flex;
    justify-content: space-between;
    width: 100%;
    align-items: center;
    padding: 10px;
}

{% comment %} .title-buttons {
    display: flex;
    align-items: center;
} {% endcomment %}

.like-button, .share-button {
    margin-left: 10px;
}

.page-title {
    font-size: 20px;
    font-weight: bold;
    margin: 0;
    margin-right: auto;
}

.title-info-container {
    display: flex;
    justify-content: space-between;
    width: 100%;
    align-items: center;
    padding: 10px;
}       

.title-info {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    margin-right: auto;
}

.comment {
    margin-left: 10px;
}
.image-description {
    margin-top: 10px;
    text-align: left;
}

.image-description h3 {
    font-size: 20px;
    font-weight: bold;
    margin: 0;
}

.image-description p {
    font-size: 16px;
    margin: 0;
}
.itinerary {
  margin: 20px 0;
}
.review-container{
    margin: 80px auto;
    max-width: 1000px;
}
.review-container .btn-style-1 {
    background-color: ;
    border-radius: 50px;
    padding: 0.5rem 1rem;
    border: 2px solid #000;
    font-weight: bold;
  }
  
  .review-container .btn-style-2 {
    background-color: #fff;
    border-radius: 50px;
    padding: 0.5rem 1rem;
    border: 2px solid #e6e6e6;
    font-weight: bold;
  }
  
  .review-container .review {
    margin-top: 2rem;
    margin-bottom: 1rem;
  }
  
  .review-container .review-wrap {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  
  .review-container .tag {
    border: 1px solid #5a9bd5;
    padding: 5px 10px;
    border-radius: 50px;
  }
  
  .review-container .tag.active {
    border: 1px solid rgba(90, 155, 213, 0.2);
    background-color: rgba(90, 155, 213, 0.2);
  }
  
  .review-container .review-content {
    margin: 2rem 1rem;
    padding: 1rem;
    border-bottom: 1px solid #eee;
  }
  
  .review-container .head {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .review-container .head .info{
      display: flex;
      justify-content: center;
      align-items: center;
  }
  
  .review-container .user-name {
    font-weight: bold;
  }
  
  .review-container .user-img {
    height: 50px;
    width: 50px;
    border-radius: 50%;
    margin-right: 1rem;
  }
  
  .review-container .review-img {
    width: 100px;
    height: 100px;
    overflow: hidden;
  }
  
  .review-container .review-img img {
      height: 100%;
      width: auto;
  }
  .review-container .title {
    padding: 0;
    margin: 0;
  }
  .title-buttons .share-button,
  .title-buttons .like-button {
      display: inline-flex;
      align-items: center;
      cursor: pointer;
      transition: transform 0.3s ease;
  }
  
  .title-buttons .share-button:hover,
  .title-buttons .like-button:hover {
      transform: scale(1.2);
  }

  .main-container {
    display: flex;
  }

  .main-container img {
    width: 100%;
    height: 100%;
  }

  .main-container .main-content {
    width: 720px;
    height: 480px;
  }

  .main-container .sub-content {
    width: calc(100% - 720px);
    margin-left: 1rem;
    height: 480px;
    box-sizing: border-box;
  }

  .main-container .sub-item {
    margin-bottom: 1rem;
    height: calc(50% - 0.5rem);

  }
  .title-buttons .share-button,
  .title-buttons .like-button {
    display: inline-flex;
    align-items: center;
    cursor: pointer;
    transition: transform 0.3s ease;
    font-size: 20px;
  }

  .title-buttons .share-button:hover,
  .title-buttons .like-button:hover {
    transform: scale(1.2);
  }
  .fa-regular.fa-thumbs-up {
    font-size: 20px;
    transition: transform 0.3s ease;
  }

  .fa-regular.fa-thumbs-up:hover {
    transform: scale(1.2);
  }
  .dayDiv {
    user-select: none;
    display: block;
    width: 80px;
    height: 40px;
    line-height: 40px;
    border: 1px solid rgba(128, 128, 128, 0.46);
    border-top-right-radius: 20px;
    border-top-left-radius: 20px;
    text-align: center;
    cursor: pointer;
    margin-top: 10px;
}

.dayContent {
  user-select: none;
  width: 100%;
  height: 300px;
  border: 1px solid rgba(128, 128, 128, 0.46);
  display: flex;
  align-items: center;
  align-content: center;
  overflow-x: scroll;
  overflow-y:hidden;
}

.car_icon {
    height: 300px;
    line-height: 300px;
    {% comment %} margin: 120px 5px 0; /* Adjust the top margin value to move it down */ {% endcomment %}
    cursor: pointer;
}

.dayContentIntro {
    width: 250px;
    min-width: 250px;
    height: 250px;
    padding: 10px 5px;
    border: 1px solid black;
    border-radius: 30px;
    margin-bottom: 10px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
.avatar img {
  border-radius: 50%;
}
#cancel-success-modal {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  padding: 20px;
  background-color: white;
  border: 1px solid #ccc;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  z-index: 999;
}

#cancel-success-modal h3 {
  color: #333;
}

#cancel-success-modal button {
  margin-top: 10px;
  padding: 8px 16px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.icon_add {
  text-align: right;
  font-size: 24px;

  right: 10%;
}

.icon_name {
  display: inline-block;
  border: 1px solid gray;
  border-radius: 50%;
  padding: 2px 8px 2px 8px;
  background-color: white;
}

.icon_name:hover {
  background-color: #000;
  color: white;
}

</style>
{% endblock %}



{% block body %}
{% comment %} 內容在這~~~ {% endcomment %}
<div class="container">
  <header class="row" style="padding: 0px;margin: 0px;">
    <h1 class="col-6 page-title">{{ct_detail.ct_name}}</h1>
    
    {% comment %} <div class="share-button" id="share-button"><i class="fa-solid fa-arrow-up-from-bracket"></i></div> {% endcomment %}
    {% comment %} <div class="like-button" id="like-button"><i class="fa-solid fa-heart"></i></div> {% endcomment %}
    <div class="col-6 detail_name__headerGrid icon_add">
      {% comment %} <i class="fa-solid fa-arrow-up-from-bracket icon_name" id="share_icon"
          onclick=" showShareLoaderAndContent()" title="分享"
          style="border: black solid; border-radius: 60px;padding:8px 10px 8px 10px;"></i> {% endcomment %}
      {% if ct_detail.is_favorite == "1" %}
      <div class="icon_name" id="submitfavorite{{ct_detail.id}}"
          onclick="addFavorite_travel(this,{{ct_detail.id}})">
          <i class="fas fa-regular fa-heart" title="已收藏" style="color: rgb(202, 13, 13);"></i>
      </div>
      {% else %}
      <div class="icon_name" id="submitfavorite{{ct_detail.id}}"
          onclick="addFavorite_travel(this,{{ct_detail.id}})">
          <i class="fas fa-regular fa-heart" title="收藏" style="color: rgb(111, 110, 110);"></i>
      </div>
      {% endif %}
    </div>

  </header>
  <div class="title-info-container">
    <div class="title-info">
        <p class="provider">作者：{{ct_detail.u.username}}</p>
        {% comment %} <p class="reviews-count">有幾則評論：</p> {% endcomment %}
    </div>
  </div>
  <section class="main-container">
    <div class="main-content">
      <img src="../static/images/attractions/{{ct_detail.get_attractions_picture.0.a__place_id}}_0.jpg">
    </div>
    <div class="sub-content">
      <div class="sub-item">
        <img src="../static/images/attractions/{% if ct_detail.get_attractions_picture.1.a__place_id %}{{ ct_detail.get_attractions_picture.1.a__place_id }}_0.jpg {% else %}{{ ct_detail.get_attractions_picture.0.a__place_id }}_1.jpg{% endif %}">
      </div>
      <div class="sub-item">
        <img src="../static/images/attractions/{% if ct_detail.get_attractions_picture.2.a__place_id %}{{ ct_detail.get_attractions_picture.2.a__place_id }}_0.jpg {% else %}{{ ct_detail.get_attractions_picture.0.a__place_id }}_2.jpg{% endif %}">
      </div>
    </div>
  </section>
  <div class="image-description">
    <h3>關於</h3>
    <p style="margin:5px 0px 20px 0px">{% if ct_detail.detail == "" %}目前還沒有內容{% else %}{{ct_detail.detail}}{% endif %}</p>
  </div>
  <div class="dayDoneSection">
    <div class="dayDone">
        <div class="dayDoneBtn">
          {% for day in ct_detail.get_choice_day %}
            <div class="dayDiv" id="dayDiv{{forloop.counter}}" data-day="{{forloop.counter}}" style="float: left; {% if forloop.counter == 1 %}color:orange;{% endif %}" onclick="clickDay({{forloop.counter}})">
                <i class="fa-regular fa-calendar"></i> DAY {{forloop.counter}}
            </div>
          {% endfor %}
        </div>
    </div>
    {% for data in all_data %}
      <div class = "classDayContent" id="content{{forloop.counter}}" style={% if forloop.counter == 1 %}"display: block;"{% else %}"display: none;"{% endif %}>
        <div class="dayContent">
            <div style="height: 250px;min-width:80px;display: flex;justify-content: center;align-items: center;align-content: center;">
                起始<br>位置
            </div>
                {% for a_data in data.ct_attraction %}
                {{a_data.a_id.start_location_y}}
                  {% if forloop.counter == 1 %}
                    <a href="https://www.google.com/maps/dir/{{a_data.choice_ct.start_location_x}},{{a_data.choice_ct.start_location_y}}/{{a_data.a.location_x}},{{a_data.a.location_y}}/" target="_blank" style="text-decoration: none;color: black;height:300px;line-height:300px;margin:0 10px;">
                      <i class="fa-solid fa-car-side car_icon"></i>
                    </a>
                  {% else %}
                    <a href="https://www.google.com/maps/dir/{{a_data.get_previous.a.location_x}},{{a_data.get_previous.a.location_y}}/{{a_data.a.location_x}},{{a_data.a.location_y}}/" target="_blank" style="text-decoration: none;color: black;height:300px;line-height:300px;margin:0 10px;">
                      <i class="fa-solid fa-car-side car_icon"></i>
                    </a>
                  {% endif %}
                  <div class="dayContentIntro" style="text-align: center;">
                      <p style="font-size: 20px;"><b>{{a_data.a.a_name}}</b></p>
                      <p>營業時間<br>{% for open in a_data.opening.opening %} {% if forloop.counter != 1  %} <br> {% endif %}{{open}} {% endfor %}</p>
                      <p>停留時間：{{a_data.stay_time}}分鐘</p>
                  </div>
                {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>

  <section class="review-container">
    <div class="row">
      <h5 style="font-size: 24px;">
          <i class="fa-solid fa-pen" style="color: gray;"></i>
          評論
      </h5>
    </div>
    <div>
      {% comment %} <button class="btn-style-1">發表評論</button> {% endcomment %}
    </div>

    <form class="ask-content" id="ask-content" action="/comment/{{detail.id}}/" method="POST">
      <div class="out_share_comment" id="out_share_comment">
          <div id="share_comment_container" class="share_comment_container">
              <form class="share_comment-content" id="share_comment-content" action="">
                  <div class="comment_container" id="comment_container">
                      <h5 style="font-size: 24px;">
                          {{ detail.a_name }}
                      </h5>
                  </div>
                  <div class="share_comment_con" style="padding: 20px;">
                      <div class="comment">
                          <div class="avatar">
                              <img src="{{request.user.get_photo}}" alt="User Avatar">
                          </div>
                          <div class="comment-content">
                              <h6 class="username">
                                  {{request.user.username}}<br>
                                  <span style="color: gray; font-size: 14px; font-style: italic;">公開發佈
                                      &ensp;</span>
                                  </h6>
                          </div>
                      </div>
                      <div>
                          <textarea name="user_share_comment" id="user_share_comment" cols="100%" rows="5"
                              style="resize:none; border-radius: 10px;max-width: 100%;padding: 10px; "
                              placeholder="詳細說明你在這個地點的親身體驗。"></textarea>
                      </div>
                      <div class="image-container_ph">
                          <div id="imagePreview"></div>
                      </div>
                  </div>
                  <div class="post_share_comment">
                      <span class="share_comment_btn_ok" id="share_comment_btn_ok"
                          onclick="sendComment({{ct_detail.id}})">張貼</span>
                  </div>
              </form>
          </div>
      </div>
    </form>
  

    <section class="review">
      <div class="review-wrap">
        <h2>所有評論</h2>
      </div>

    </section>
    <hr>
    <section>
      {% for comment in ct_detail.get_comment %}
        <div class="review-content">
          <div class="head">
            <div class="info">
              <img class="user-img" src="{{comment.u.get_photo}}" alt="">
              <p class="user-name">{{comment.u.username}}<br>{{comment.comment_date}}</p>
              <p></p>
            </div>
            {% comment %} <div>
              <i class="fa-regular fa-thumbs-up" onclick="like()"></i>
            </div> {% endcomment %}
          </div>
          <div class="body">
            <p>{{comment.content}}</p>
          </div>
        </div>
      {% endfor %}
    </section>
  </section>
</div>
<script>
  // 獲取按鈕元素
  /*var newestButton = document.querySelector('.btn-style-2:nth-child(2)');
  var oldestButton = document.querySelector('.btn-style-2:nth-child(3)');

  // 添加點擊事件監聽器
  newestButton.addEventListener('click', function() {
    // 添加藍色樣式
    newestButton.style.backgroundColor = '#0066DB';
    // 移除其他按鈕的藍色樣式
    oldestButton.style.backgroundColor = '';
  });

  oldestButton.addEventListener('click', function() {
    // 添加藍色樣式
    oldestButton.style.backgroundColor = '#0066DB';
    // 移除其他按鈕的藍色樣式
    newestButton.style.backgroundColor = '';
  });*/
  function like(){
    alert('已按讚');
  }
  const contentMap = {
    1: document.getElementById('content1'),
    2: document.getElementById('content2')
  };
  {% comment %} function clickDay(dayNumber){
    const dayDiv1 = document.getElementById('dayDiv'+dayNumber);
    dayDiv1.style.backgroundColor = 'red';
    openContent(dayNumber);
  } {% endcomment %}
  let lastClicked = false;

  function clickDay(dayNumber) {
      let content = document.querySelectorAll('.classDayContent');
      let clickContent = document.getElementById('content' + dayNumber);
      const dayDiv = document.querySelectorAll('.dayDiv');
      const dayDiv1 = document.getElementById('dayDiv'+dayNumber);
      if (clickContent.style.display == 'block') {
          // 如果連續點擊同一天，則關閉對應內容
          clickContent.style.display = 'none';
          dayDiv1.style.color="";
      } else {
        for (let i = 0; i < content.length; i++) {
          content[i].style.display = 'none';
          dayDiv[i].style.color="";
        }
          clickContent.style.display = 'block';
          dayDiv1.style.color = 'orange';
      }
  }

{% comment %} 
  // 事件代理，監聽所有.dayDiv的點擊事件
  document.addEventListener('click', function(event) {
      if (event.target.classList.contains('dayDiv')) {
          const dayNumber = parseInt(event.target.getAttribute('data-day'));
          openContent(dayNumber);
      }
  }); {% endcomment %}
  function sendComment(cid) {
    var isPostConfirmed = confirm("確定要張貼評論嗎？");

    if (isPostConfirmed) {
        // 在這裡執行張貼的相關操作
        $.ajax({
            url: '/travel_comment/',
            type: 'POST',
            data: {
                'csrfmiddlewaretoken': '{{ csrf_token }}',
                'comment': $('#user_share_comment').val(),
                'cid': cid,
            },
            success: function (data) {
              location.reload()
            }
        });
        alert("張貼成功");
    } else {
        alert("已取消張貼");
    }
  }

  /*document.getElementById('share_comment_btn_cancel').addEventListener('click', function () {
      var isCancelConfirmed = confirm("確定要取消嗎？");

      if (isCancelConfirmed) {
          // 在這裡執行取消的相關操作
          alert("取消成功");
      } else {
          alert("已取消取消");
      }
  });*/
</script>
<script src="/static/js/travel_detail.js"></script>
<script src="/static/js/addFavorite.js"></script>
    {% comment %} {{u_id}}
    <p>{{ ct_id }}</p>
    <p>{{ ct_detail }}</p>
    <p>{{ ct_choiceday }}</p>
    <p>{{ ct_attraction }}</p> {% endcomment %}
{% endblock body %}